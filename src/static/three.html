<html>
	<head>
		<title>three js freestle tutorial</title>
		<style>
			body { margin: 0; }
			canvas { width: 100%; height: 100% }
		</style>
	</head>
	<body>
		<script src="/three.js"></script>
		<script>
			var scene = new THREE.Scene();
			var camera = new THREE.PerspectiveCamera( 75, window.innerWidth/window.innerHeight, 0.1, 1000 );

			var renderer = new THREE.WebGLRenderer();
			renderer.setSize( window.innerWidth, window.innerHeight );
			document.body.appendChild( renderer.domElement );


			camera.position.z = 5;
			var MAX_POINTS = 500;

			// geometry
			var geometry = new THREE.BufferGeometry();

			// attributes
			var positions = new Float32Array( MAX_POINTS * 3 ); // 3 vertices per point
			geometry.addAttribute( 'position', new THREE.BufferAttribute( positions, 3 ) );

			// draw range
			var drawCount = 2; // draw the first 2 points, only
			geometry.setDrawRange( 0, drawCount );

			// material
			var material = new THREE.LineBasicMaterial( { color: 0x6ce4ff, linewidth: 2 } );

			// line
			var line = new THREE.Line( geometry,  material );
			scene.add( line );			
			var positions = line.geometry.attributes.position.array;

			var x, y, z, index;
			x = y = z = index = 0;

			function captureCamera(e) {
				const alpha = 0.001;
				camera.rotation.y += alpha*e.movementX;
				camera.rotation.x += alpha*e.movementY;
			}

			document.addEventListener('mousedown', function() {
				document.addEventListener('mousemove', captureCamera);
			});
			document.addEventListener('mouseup', function() {
				document.removeEventListener('mousemove', captureCamera);
			});

			document.addEventListener('mousewheel', function(e) {
				const alpha = 0.001;
				e.preventDefault();
				camera.translateZ(alpha*e.deltaY);
			})

			for ( var i = 0, l = MAX_POINTS; i < l; i ++ ) {

			    positions[ index ++ ] = x;
			    positions[ index ++ ] = y;
			    positions[ index ++ ] = z;

			    x += ( Math.random() - 0.5 );
			    y += ( Math.random() - 0.5 );
			    z += ( Math.random() - 0.5 );


			}

			line.geometry.setDrawRange( 0, MAX_POINTS );

			const rnd = Math.random();
			const multiplier = 1 - Math.pow(rnd - .5, 7);
			console.log(multiplier);
			var animate = function () {
				requestAnimationFrame( animate );

				index = 0;
				for ( var i = 0, l = MAX_POINTS; i < l; i ++ ) {
				    positions[ index ++ ] *= multiplier;
				    positions[ index ++ ] *= multiplier;
				    positions[ index ++ ] *= multiplier;
				    positions[ index ++ ] += ( Math.random() - 0.5 )*0.025;
				    positions[ index ++ ] += ( Math.random() - 0.5 )*0.025;
				    positions[ index ++ ] += ( Math.random() - 0.5 )*0.025;
				}

				line.geometry.attributes.position.needsUpdate = true;
				renderer.render(scene, camera);
			};
			animate();
		</script>
	</body>
</html>